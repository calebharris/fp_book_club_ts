<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter 3. Functional data structures | Functional Programming in TypeScript</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/fp_book_club_ts/assets/css/0.styles.2e0fd9ce.css" as="style"><link rel="preload" href="/fp_book_club_ts/assets/js/app.ba8d5564.js" as="script"><link rel="preload" href="/fp_book_club_ts/assets/js/2.02fd0292.js" as="script"><link rel="preload" href="/fp_book_club_ts/assets/js/8.57c5fc43.js" as="script"><link rel="prefetch" href="/fp_book_club_ts/assets/js/10.c3c08d9c.js"><link rel="prefetch" href="/fp_book_club_ts/assets/js/11.3e4fd880.js"><link rel="prefetch" href="/fp_book_club_ts/assets/js/12.1ec8026e.js"><link rel="prefetch" href="/fp_book_club_ts/assets/js/3.d2883898.js"><link rel="prefetch" href="/fp_book_club_ts/assets/js/4.7da4fb13.js"><link rel="prefetch" href="/fp_book_club_ts/assets/js/5.599a7ac7.js"><link rel="prefetch" href="/fp_book_club_ts/assets/js/6.d708eb58.js"><link rel="prefetch" href="/fp_book_club_ts/assets/js/7.eb897770.js"><link rel="prefetch" href="/fp_book_club_ts/assets/js/9.31d54afd.js">
    <link rel="stylesheet" href="/fp_book_club_ts/assets/css/0.styles.2e0fd9ce.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fp_book_club_ts/" class="home-link router-link-active"><!----> <span class="site-name">Functional Programming in TypeScript</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fp_book_club_ts/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Chapters</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_1.html" class="nav-link">Chapter 1</a></li><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_2.html" class="nav-link">Chapter 2</a></li><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_3.html" class="nav-link router-link-exact-active router-link-active">Chapter 3</a></li><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_4.html" class="nav-link">Chapter 4</a></li><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_5.html" class="nav-link">Chapter 5</a></li><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_6.html" class="nav-link">Chapter 6</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/calebharris/fp_book_club_ts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fp_book_club_ts/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Chapters</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_1.html" class="nav-link">Chapter 1</a></li><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_2.html" class="nav-link">Chapter 2</a></li><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_3.html" class="nav-link router-link-exact-active router-link-active">Chapter 3</a></li><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_4.html" class="nav-link">Chapter 4</a></li><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_5.html" class="nav-link">Chapter 5</a></li><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_6.html" class="nav-link">Chapter 6</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/calebharris/fp_book_club_ts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/fp_book_club_ts/chapter_1.html" class="sidebar-link">Chapter 1. What is functional programming?</a></li><li><a href="/fp_book_club_ts/chapter_2.html" class="sidebar-link">Chapter 2. Getting started with functional programming in TypeScript</a></li><li><a href="/fp_book_club_ts/chapter_3.html" class="active sidebar-link">Chapter 3. Functional data structures</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#defining-functional-data-structures" class="sidebar-link">Defining functional data structures</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#representing-algebraic-data-types-in-typescript" class="sidebar-link">Representing algebraic data types in TypeScript</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-1-type-inference" class="sidebar-link">Exercise 3.1. Type inference</a></li></ul></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#data-sharing-in-functional-data-structures" class="sidebar-link">Data sharing in functional data structures</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-2-gettail" class="sidebar-link">Exercise 3.2. getTail</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-3-sethead" class="sidebar-link">Exercise 3.3. setHead</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-4-drop" class="sidebar-link">Exercise 3.4. drop</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-5-dropwhile" class="sidebar-link">Exercise 3.5. dropWhile</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-6-init" class="sidebar-link">Exercise 3.6. init</a></li></ul></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#recursion-over-lists-and-generalizing-to-higher-order-functions" class="sidebar-link">Recursion over lists and generalizing to higher-order functions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-7-foldright-and-short-circuiting" class="sidebar-link">Exercise 3.7. foldRight and short-circuiting</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-8-relationship-between-foldright-and-list-data-constructors" class="sidebar-link">Exercise 3.8. Relationship between foldRight and List data constructors</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-9-length-via-foldright" class="sidebar-link">Exercise 3.9. length via foldRight</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-10-foldleft" class="sidebar-link">Exercise 3.10. foldLeft</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-11-refactor-sum-product-and-length" class="sidebar-link">Exercise 3.11. Refactor sum, product, and length</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-12-reverse" class="sidebar-link">Exercise 3.12. reverse</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-13-foldright-and-foldleft-in-terms-of-each-other" class="sidebar-link">Exercise 3.13. foldRight and foldLeft in terms of each other</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-14-refactor-append" class="sidebar-link">Exercise 3.14. Refactor append</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-15-concat" class="sidebar-link">Exercise 3.15 concat</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#more-functions-for-working-with-lists" class="sidebar-link">More functions for working with lists</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-16-add-1-to-each-element" class="sidebar-link">Exercise 3.16. Add 1 to each element</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-17-convert-number-to-string" class="sidebar-link">Exercise 3.17. Convert number to string</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-18-map" class="sidebar-link">Exercise 3.18. map</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-19-filter" class="sidebar-link">Exercise 3.19. filter</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-20-flatmap" class="sidebar-link">Exercise 3.20. flatMap</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-21-filter-in-terms-of-flatmap" class="sidebar-link">Exercise 3.21. filter in terms of flatMap</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-22-add-corresponding-elements" class="sidebar-link">Exercise 3.22. Add corresponding elements</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-23-zipwith" class="sidebar-link">Exercise 3.23. zipWith</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#loss-of-efficiency-when-assembling-list-functions-from-simpler-components" class="sidebar-link">Loss of efficiency when assembling list functions from simpler components</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-24-hassubsequence" class="sidebar-link">Exercise 3.24. hasSubsequence</a></li></ul></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#trees" class="sidebar-link">Trees</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-25-size" class="sidebar-link">Exercise 3.25. size</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-26-maximum" class="sidebar-link">Exercise 3.26. maximum</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-27-depth" class="sidebar-link">Exercise 3.27. depth</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-28-map" class="sidebar-link">Exercise 3.28. map</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#exercise-3-29" class="sidebar-link">Exercise 3.29</a></li></ul></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_3.html#summary" class="sidebar-link">Summary</a></li></ul></li><li><a href="/fp_book_club_ts/chapter_4.html" class="sidebar-link">Chapter 4. Handling errors without exceptions</a></li><li><a href="/fp_book_club_ts/chapter_5.html" class="sidebar-link">Chapter 5. Strictness and laziness</a></li><li><a href="/fp_book_club_ts/chapter_6.html" class="sidebar-link">Chapter 6. Purely functional state</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="chapter-3-functional-data-structures"><a href="#chapter-3-functional-data-structures" aria-hidden="true" class="header-anchor">#</a> Chapter 3. Functional data structures</h1> <p>We said in the introduction that functional programs don't update variables or modify mutable data structures (except in
iterative loops, of course). So what kinds of data structures <em>can</em> we use? <em>Functional data structures</em>, of course!
This chapter talks about how we define data types in functional programming and a related logical branching technique
called <em>pattern matching</em>. It has a ton of exercises, too, to provide practice writing and generalizing pure functions.
In general, the book is trying to lead us to higher level functional abstractions - things like <em>monoids</em>, <em>functors</em>,
<em>monads</em>, and other structures with weird names borrowed from <a href="https://en.wikipedia.org/wiki/Category_theory" title="Category theory - Wikipedia" target="_blank" rel="noopener noreferrer">category theory<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="defining-functional-data-structures"><a href="#defining-functional-data-structures" aria-hidden="true" class="header-anchor">#</a> Defining functional data structures</h2> <p>A functional data structure is only operated on with pure functions. Pure functions cannot modify data in place or
perform side effects. Thus, by definition, functional data structures are immutable.</p> <p>Let's start by talking about everyone's favorite functional data structure - a singly linked list. Of course, we're
going to dive into some new TypeScript syntax, as well.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">/**
 * list.ts - a functional singly linked list implementation using a
 * discriminated union, a.k.a. algebraic data type (ADT). Based on
 * guidance at
 * https://www.typescriptlang.org/docs/handbook/advanced-types.html
 */</span>

<span class="token comment">/**
 * The &quot;root&quot; definition of our List data type, with one type parameter, `A`.
 * Note that List is defined entirely by its constituent types, using
 * TypeScript's type union syntax, `|`.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=</span> Cons<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">|</span> Nil<span class="token punctuation">;</span>

<span class="token comment">/**
 * Nil represents the empty list
 */</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Nil</span> <span class="token punctuation">{</span>
  tag<span class="token punctuation">:</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Our &quot;data constructor&quot; for Nil, which has only one instance
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> Nil<span class="token punctuation">:</span> Nil <span class="token operator">=</span> <span class="token punctuation">{</span> tag<span class="token punctuation">:</span> <span class="token string">&quot;nil&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * A data constructor representing a link in the list, containing a value in
 * `head` and a pointer to the remainder of the list in `tail`. Every tail is
 * a complete List in its own right, with Nil signifying the &quot;end&quot; of the
 * list.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Cons</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  tag<span class="token punctuation">:</span> <span class="token string">&quot;cons&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;cons&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">readonly</span> head<span class="token punctuation">:</span> <span class="token constant">A</span><span class="token punctuation">,</span> <span class="token keyword">readonly</span> tail<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Creates a List from a variable number of arguments.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> List <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">...</span>vals<span class="token punctuation">:</span> <span class="token constant">A</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vals<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> Nil<span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Cons</span><span class="token punctuation">(</span>vals<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token operator">...</span>vals<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Uses recursion and pattern matching to add up a list of numbers
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> sum <span class="token operator">=</span> <span class="token punctuation">(</span>ns<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>ns<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// the sum of the empty list is 0</span>
    <span class="token keyword">case</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// the sum of a list is the value in the head plus the sum of the tail</span>
    <span class="token keyword">case</span> <span class="token string">&quot;cons&quot;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> ns<span class="token punctuation">.</span>head <span class="token operator">+</span> <span class="token function">sum</span><span class="token punctuation">(</span>ns<span class="token punctuation">.</span>tail<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Multiplies a list of numbers together, using the same technique as `sum`
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> product <span class="token operator">=</span> <span class="token punctuation">(</span>ns<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>ns<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;cons&quot;</span><span class="token punctuation">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>ns<span class="token punctuation">.</span>head <span class="token operator">===</span> <span class="token number">0.0</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span>
        <span class="token keyword">return</span> ns<span class="token punctuation">.</span>head <span class="token operator">*</span> <span class="token function">product</span><span class="token punctuation">(</span>ns<span class="token punctuation">.</span>tail<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><p>One bit of new syntax shows up twice in the <code>List</code> function: the <code>...</code> operator. It's actually two different operators
that happen to look the same and do related things. In <code>const List = &lt;A&gt;(...vals: A[])</code>, the <code>...</code> is the
<em>rest-parameter</em> operator. Other languages call this <em>variadic function</em> syntax. Either way, the result is a function
that accepts a variable number of arguments of type <code>A</code>, which are represented inside the function as an array.</p> <p>Later, in <code>List(...vals.slice(1))</code>, the <code>...</code> is called the <em>spread operator</em>. If we think of a rest parameter as
&quot;collapsing&quot; a parameter list into an array, then the spread operator does the opposite. It spreads an array into a
parameter list.</p> <p>A second bit of new syntax is in the <code>constructor</code> of <code>Cons</code>. Recall that the <a href="/fp_book_club_ts/chapter_1.html#adding-a-payments-object" title="Chapter 1 - Functional Programming in TypeScript"><code>Charge</code> class of Chapter 1</a>
defines a couple properties and initializes them in its constructor.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">Charge</span> <span class="token punctuation">{</span>
  <span class="token keyword">readonly</span> cc<span class="token punctuation">:</span> CreditCard<span class="token punctuation">;</span>
  <span class="token keyword">readonly</span> amount<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">cc<span class="token punctuation">:</span> CreditCard<span class="token punctuation">,</span> amount<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cc <span class="token operator">=</span> cc<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>amount <span class="token operator">=</span> amount<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>This is a pretty common thing to need to do, so TypeScript provides a shortcut. The following code achieves the exact
same result, but is much less verbose.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">Charge</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">readonly</span> cc<span class="token punctuation">:</span> CreditCard<span class="token punctuation">,</span> <span class="token keyword">readonly</span> amount<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>The <code>Cons</code> constructor, along with the constructor functions of many data types throughout this book, uses this
shortcut.</p> <p>If you're familiar with object-oriented programming, and someone asks you to create a data type called <code>List</code> with two
implementations, you probably immediately reach for some kind of subtyping, maybe with <code>List</code> as the parent interface or
abstract class and two implementors or subclasses, <code>Nil</code> and <code>Cons</code>. We don't see that in the code above, so what
exactly is going on here?</p> <p>In FP, we often use a pattern called an <em>Algebraic Data Type</em> (ADT), also called a <em>discriminated union</em>, to represent
data structures. This kind of structure ends up being more natural to work with than traditional OOP class hierarchies.
It also enables a technique called <em>pattern matching</em>, which allows us to get some help from the compiler when writing
functions for ADTs.</p> <p>TypeScript, being both a &quot;lightweight&quot; language and something of a hybrid beast between OOP and FP, does not directly
support either ADTs or pattern matching, but does have some lower-level features that allow us to &quot;build up&quot; to those
techniques. Strap in, we've got some reading to do.</p> <h2 id="representing-algebraic-data-types-in-typescript"><a href="#representing-algebraic-data-types-in-typescript" aria-hidden="true" class="header-anchor">#</a> Representing algebraic data types in TypeScript</h2> <p>Our goal is to define an ADT that represents a singly linked list. Lists of this kind are useful tools for exploring FP
because they can be defined and constructed recursively: each subpart of the list is itself a list.  Therefore, we need
two variants of our List type: one to represent a link in the list and one to represent the empty list. We call the
variants <em>data constructors</em>, and they are <code>Cons</code> and <code>Nil</code>. The <code>List</code> type is defined as the union of <code>Cons</code> and
<code>Nil</code>.</p> <p>Now, we could have chosen to create a parent class or interface for <code>List</code> and still achieved roughly the same thing. We
didn't do that for a couple reasons. There is no common functionality between <code>Cons</code> and <code>Nil</code>, so a class isn't really
appropriate.</p> <p>The reasoning behind not using an interface is a bit more complex. Unlike traditional class hierarchies, an ADT is not
meant to be extended. The &quot;algebraic&quot; descriptor means that our data type is really a formulation of other, known data
types, which cannot be true if there is the possibility of someone else adding a variant to our ADT! So we want a way to
define a closed set of types that allows us to write functions that accept any member of the set and prevents the
addition of new members. Enter TypeScript's union type:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">type</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=</span> Cons<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">|</span> Nil<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This declares a type alias named <code>List</code>, with one type parameter <code>A</code>, that can be either a <code>Cons&lt;A&gt;</code> or <code>Nil</code>. We cannot
add types to <code>List</code> after it has been declared, but we can write functions that accept any <code>List</code> value. In the snippet
below, <code>ns</code> will be either a <code>Cons&lt;number&gt;</code> or <code>Nil</code>.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> sum <span class="token operator">=</span> <span class="token punctuation">(</span>ns<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The union type is the first TypeScript feature that we're using to implement an ADT. The second is the <em>literal type</em>.
You may have noticed that both <code>Nil</code> and <code>Cons</code> have a property called <code>tag</code>, each with an unusual type annotation:
<code>&quot;nil&quot;</code> and <code>&quot;cons&quot;</code>, respectively. The code <code>tag: &quot;nil&quot;</code> declares the <code>tag</code> property to be of the literal type <code>&quot;nil&quot;</code>,
which is a kind of constrained <code>string</code> type that can only ever hold one value: <code>&quot;nil&quot;</code>. Attempting to assign any other
value to it results in a compiler error. Because literal types can only hold one value (i.e. have only one
<em>inhabitant</em>), they are also called <em>singleton types</em>. ADTs, or discriminated unions, are also called <em>tagged unions</em>,
hence the property name <code>tag</code>. We could have called it <code>discriminator</code>, but that's kind of a long word and we're lazy.</p> <p>To understand why the <code>tag</code>s matter, we need to talk about a third TypeScript feature called <em>type guards</em>. A type guard
is a conditional that guarantees a value has a specific type. Inside the conditional, we can then safely treat the value
as that type. For example:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> printHead <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token parameter">ls<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ls<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;cons&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`The head is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ls<span class="token punctuation">.</span>head<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;We're headless!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>This code compiles because <code>ls.tag === &quot;cons&quot;</code> is a type guard, allowing the TypeScript compiler to know that, inside
the <code>if</code> block, <code>ls</code> must be a <code>Cons</code>, so that the <code>ls.head</code> property access is legal. This is type inferencing at work,
and it hinges on TypeScript knowing that every variant of <code>List</code> has a <code>tag</code> property, but only one variant has a <code>tag</code>
property that can possibly hold a value of <code>&quot;cons&quot;</code> (thanks, literal types!), so that if <code>ls.tag === &quot;cons&quot;</code> is <code>true</code>,
then <code>ls</code> <em>must</em> be a <code>Cons</code>.</p> <p>There is one more feature of ADTs often supported by FP languages that we have not yet achieved, which is
<em>exhaustiveness checking</em>. It would be helpful for the compiler to warn us if we haven't handled every variant of an
ADT, in order to avoid undefined behavior. Fortunately, once again due to TypeScript's type inferencing, we don't have
to do anything special. Consider this function:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> getHead <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>ls<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token constant">A</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ls<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;cons&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> ls<span class="token punctuation">.</span>head<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Attempting to compile it leads to this error:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[eval].ts(13,35): error TS2366: Function lacks ending return statement and
return type does not include 'undefined'.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>This is a bit of a subtle message, but makes more sense if you keep in mind that a function lacking an explicit return
value returns <code>undefined</code>. In strict mode, TypeScript does not allow us to have <code>undefined</code> or <code>null</code> values unless we
explicitly allow it, which we won't get into now.</p> <p>We'll often use type guards and exhaustiveness checking with switch statements, which gives us something close to the
pattern matching capability offered by other FP languages. Hopefully, the <code>sum</code> function for <code>List</code> makes complete sense
to you now:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> sum <span class="token operator">=</span> <span class="token punctuation">(</span>ns<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>ns<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;cons&quot;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> ns<span class="token punctuation">.</span>head <span class="token operator">+</span> <span class="token function">sum</span><span class="token punctuation">(</span>ns<span class="token punctuation">.</span>tail<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="exercise-3-1-type-inference"><a href="#exercise-3-1-type-inference" aria-hidden="true" class="header-anchor">#</a> Exercise 3.1. Type inference</h3> <p>Given these declarations:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">Nil</span> <span class="token punctuation">{</span> tag<span class="token punctuation">:</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">SingleCons</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  tag<span class="token punctuation">:</span> <span class="token string">&quot;cons&quot;</span><span class="token punctuation">;</span>
  head<span class="token punctuation">:</span> <span class="token constant">A</span><span class="token punctuation">;</span>
  tail<span class="token punctuation">:</span> SingleList<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> SingleList<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=</span> SingleCons<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">|</span> Nil<span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">DoubleCons</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  tag<span class="token punctuation">:</span> <span class="token string">&quot;cons&quot;</span><span class="token punctuation">;</span>
  head<span class="token punctuation">:</span> <span class="token constant">A</span><span class="token punctuation">;</span>
  tail<span class="token punctuation">:</span> DoubleList<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  prev<span class="token punctuation">:</span> DoubleList<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> DoubleList<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=</span> DoubleCons<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">|</span> Nil<span class="token punctuation">;</span>

<span class="token keyword">type</span> AnyList<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=</span> SingleList<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">|</span> DoubleList<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>What is the result of compiling the following snippets?</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token parameter">l<span class="token punctuation">:</span> SingleList<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;cons&quot;</span><span class="token punctuation">)</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>head<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><details><summary>Answer</summary> <p>This snippet compiles. The function argument <code>l</code> is constrained to be of type <code>SingleList&lt;A&gt;</code>. Within that type, only
<code>SingleCons&lt;A&gt;</code> has a <code>tag</code> property that can contain the value <code>&quot;cons&quot;</code>, so the compiler has enough information to
lookup the <code>head</code> property inside the <code>if</code> statement.</p></details> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token parameter">l<span class="token punctuation">:</span> AnyList<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;cons&quot;</span><span class="token punctuation">)</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>head<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><details><summary>Answer</summary> <p>This snippet compiles. The function argument <code>l</code> is no longer constrained to a <code>SingleList&lt;A&gt;</code>; now it can be either
that or a <code>DoubleList&lt;A&gt;</code>. Within those types, both <code>SingleCons&lt;A&gt;</code> and <code>DoubleCons&lt;A&gt;</code> have a <code>tag</code> of <code>&quot;cons&quot;</code>. So the
compiler can't narrow <code>l</code> down to only one data constructor inside the <code>if</code> statement. But, it doesn't matter, because
both possibilities support the <code>head</code> property, and it has the same type for each.</p></details> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> baz <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token parameter">l<span class="token punctuation">:</span> AnyList<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;cons&quot;</span><span class="token punctuation">)</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><details><summary>Answer</summary> <p>This snippet does not compile. Again, inside the <code>if</code> statement, the type of <code>l</code> has been inferred to be either
<code>SingleCons&lt;A&gt;</code> or <code>DoubleCons&lt;A&gt;</code>. But we try to access the <code>prev</code> property, which only exists on <code>DoubleCons</code>.
Attempting to compile this leads to an error message similar to:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>TSError: ⨯ Unable to compile TypeScript:
test.ts(34,19): error TS2339: Property 'prev' does not exist on type 'SingleCons&lt;A&gt; | DoubleCons&lt;A&gt;'.
  Property 'prev' does not exist on type 'SingleCons&lt;A&gt;'.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></details> <h2 id="data-sharing-in-functional-data-structures"><a href="#data-sharing-in-functional-data-structures" aria-hidden="true" class="header-anchor">#</a> Data sharing in functional data structures</h2> <p>How do we write functions that actually do things with immutable data structures? For instance, how can we add or remove
elements from a <code>List</code>? To add a <code>1</code> to the front of a list named <code>xs</code>, we just create a new <code>Cons</code> with the old list as
the tail: <code>new Cons(1, xs)</code>. Since <code>List</code> is immutable, we dont' have to worry about anyone changing a list out from
under us, so it's safe to reuse in new lists, without pessimistically copying it. According to the book:</p> <blockquote><p>...<em>in the large</em>, FP can often achieve greater efficiency than approaches that rely on side effects, due to much
greater sharing of data and computation.</p></blockquote> <p>Similarly, to remove an element from the front of a list, we just return its tail.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>                       Data Sharing

┌─────┬─────┐  ┌─────┬─────┐  ┌─────┬─────┐  ┌─────┬─────┐
│ &quot;a&quot; │  ●──┼─&gt;│ &quot;b&quot; │  ●──┼─&gt;│ &quot;c&quot; │  ●──┼─&gt;│ &quot;d&quot; │  ●  │
└─────┴─────┘  └─────┴─────┘  └─────┴─────┘  └─────┴─────┘
   ↑              ↑
   |              ╰──────────────────╮
   |                                 |
   ╰─ List(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;)       │
      |                              |
      |         ╭───────╮            │
      ╰─────────┤ .tail ├─────────&gt; List(&quot;b&quot;, &quot;c&quot;, &quot;d&quot;)
                ╰───────╯
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>And now... some exercises for manipulating lists.</p> <div class="tip custom-block"><p class="custom-block-title">Note</p> <p>As we complete these exercises, we'll be creating a reusable <code>List</code> module. You can find the code for <code>List</code> in the code
repo at <a href="https://github.com/calebharris/fp_book_club_ts/blob/master/code/libfpts/data_structures/list.ts" title="List - Functional Programming in TypeScript" target="_blank" rel="noopener noreferrer">/code/libfpts/data_structures/list.ts<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <h3 id="exercise-3-2-gettail"><a href="#exercise-3-2-gettail" aria-hidden="true" class="header-anchor">#</a> Exercise 3.2. <code>getTail</code></h3> <p>Implement the <code>getTail</code> function for removing the first element of a list. Notice that this function takes constant time.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> getTail <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// This version throws an exception if the caller passes an empty list, but</span>
<span class="token comment">// there are several equally &quot;correct&quot; ways to handle this scenario, such as</span>
<span class="token comment">// returning `Nil`. It's up to you as the library designer to choose a method!</span>
<span class="token keyword">const</span> getTail <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Attempt to take tail of empty list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> l<span class="token punctuation">.</span>tail<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></details> <h3 id="exercise-3-3-sethead"><a href="#exercise-3-3-sethead" aria-hidden="true" class="header-anchor">#</a> Exercise 3.3. <code>setHead</code></h3> <p>Now implement <code>setHead</code>, which <em>replaces</em> the first element of a list with a different value. For example,
<code>setHead(List(1, 2, 3), 4)</code> should return <code>List(4, 2, 3)</code>.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> setHead <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> head<span class="token punctuation">:</span> <span class="token constant">A</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> setHead <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token constant">A</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Attempt to set head of empty list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Cons</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> l<span class="token punctuation">.</span>tail<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></details> <p>The following exercises demonstrate the efficiency of data sharing.</p> <h3 id="exercise-3-4-drop"><a href="#exercise-3-4-drop" aria-hidden="true" class="header-anchor">#</a> Exercise 3.4. <code>drop</code></h3> <p>Generalize <code>tail</code> to <code>drop</code>, which removes the first <code>n</code> elements from a list. Note that this function takes time
proportional to <code>n</code>, and we do not have to make any copies.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> drop <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> n<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> drop <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> n<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Attempt to drop from empty list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> l<span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token function">drop</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>tail<span class="token punctuation">,</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></details> <h3 id="exercise-3-5-dropwhile"><a href="#exercise-3-5-dropwhile" aria-hidden="true" class="header-anchor">#</a> Exercise 3.5. <code>dropWhile</code></h3> <p>Implement <code>dropWhile</code>, which removes elements from the front of a list as long as they match a predicate.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> dropWhile <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> dropWhile <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token function-variable function">p</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Attempt to drop from empty list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">p</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span>tail<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> l<span class="token punctuation">.</span>tail<span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token function">dropWhile</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>tail<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token keyword">return</span> l<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></details> <p>A &quot;more surprising&quot; example of data sharing, this <code>append</code> implementation's runtime and memory usage are determined
entirely by the first list. The second is just tacked onto the end, so to speak.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> append <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>a1<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> a2<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>a1<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> a2<span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;cons&quot;</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Cons</span><span class="token punctuation">(</span>a1<span class="token punctuation">.</span>head<span class="token punctuation">,</span> <span class="token function">append</span><span class="token punctuation">(</span>a1<span class="token punctuation">.</span>tail<span class="token punctuation">,</span> a2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="exercise-3-6-init"><a href="#exercise-3-6-init" aria-hidden="true" class="header-anchor">#</a> Exercise 3.6. <code>init</code></h3> <p>Implement a function, <code>init</code>, that returns a <code>List</code> consisting of all but the last element of another <code>List</code>. Given
<code>List(1, 2, 3, 4)</code> your function should return <code>List(1, 2, 3)</code>. Why can't this function be implemented in constant time,
like <code>tail</code>?</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> init <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> init <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Attempt to get init of empty list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span>tail <span class="token operator">===</span> Nil<span class="token punctuation">)</span>
    <span class="token keyword">return</span> Nil<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Cons</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>head<span class="token punctuation">,</span> <span class="token function">init</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>tail<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></details> <p>Due to the structure and immutability of a <code>Cons</code>, any time we want to replace the tail of a list, we have to create a
new <code>Cons</code> element with the new <code>tail</code> value and the old <code>head</code> value. If that particular <code>Cons</code> was itself the <code>tail</code>
of a different <code>Cons</code>, <em>that</em> element now needs to be copied as well, and so on until we reach the head of the list.
According to the book:</p> <blockquote><p>Writing purely functional data structures that support different operations efficiently is all about finding
clever ways to exploit data sharing. As an example of what’s possible, in the Scala standard library there’s a
purely functional sequence implementation, Vector (documentation <a href="https://www.scala-lang.org/api/current/scala/collection/immutable/Vector.html" title="Vector - Scala Standard Library" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>), with constant-time random
access, updates, head, tail, init, and constant-time additions to either the front or rear of the sequence. See the
<a href="https://github.com/fpinscala/fpinscala/wiki/Chapter-3:-Functional-data-structures" title="Chapter 3 -
fpinscala/fpinscala Wiki" target="_blank" rel="noopener noreferrer">chapter notes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for links to further reading about how to design such data structures.</p></blockquote> <h2 id="recursion-over-lists-and-generalizing-to-higher-order-functions"><a href="#recursion-over-lists-and-generalizing-to-higher-order-functions" aria-hidden="true" class="header-anchor">#</a> Recursion over lists and generalizing to higher-order functions</h2> <p>Take another look at <code>sum</code> and <code>product</code>. These versions are simplified a bit compared to what you saw before.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> sum <span class="token operator">=</span> <span class="token punctuation">(</span>ns<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>ns<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">:</span>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;cons&quot;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> ns<span class="token punctuation">.</span>head <span class="token operator">+</span> <span class="token function">sum</span><span class="token punctuation">(</span>ns<span class="token punctuation">.</span>tail<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> product <span class="token operator">=</span> <span class="token punctuation">(</span>ns<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>ns<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">:</span>  <span class="token keyword">return</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;cons&quot;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> ns<span class="token punctuation">.</span>head <span class="token operator">*</span> <span class="token function">product</span><span class="token punctuation">(</span>ns<span class="token punctuation">.</span>tail<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Notice how similar they are? They both return a constant value in the <code>&quot;nil&quot;</code> case. In the <code>&quot;cons&quot;</code> case, they both call
themselves recursively and combine the result with <code>head</code> using a binary operator. When you see this level of structural
similarity, you can often write one generalized polymoprhic function with the same shape that takes function parameters
for the differing bits of logic. In this example, our general function needs a normal single-valued parameter for the
<code>&quot;nil&quot;</code> case and a function parameter for the operation to apply in the <code>&quot;cons&quot;</code> case.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> foldRight <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
                         z<span class="token punctuation">:</span> <span class="token constant">B</span><span class="token punctuation">,</span>
                         <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token constant">B</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token constant">B</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> z<span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;cons&quot;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>head<span class="token punctuation">,</span> <span class="token function">foldRight</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>tail<span class="token punctuation">,</span> z<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sum <span class="token operator">=</span> <span class="token punctuation">(</span>ns<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span>
  <span class="token function">foldRight</span><span class="token punctuation">(</span>ns<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> product <span class="token operator">=</span> <span class="token punctuation">(</span>ns<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span>
  <span class="token function">foldRight</span><span class="token punctuation">(</span>ns<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">*</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><code>foldRight</code> can operate on lists of any element type, and, it turns out, can return any type of value, not just the type
contained in the list! It just so happens that the types of the results of <code>sum</code> and <code>product</code> match the element types
of their <code>List</code> arguments (that is, <code>number</code>). In a sense, <code>foldRight</code> replaces the data constructors of the list,
<code>Cons</code> and <code>Nil</code>, with <code>f</code> and <code>z</code>, respectively:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token function">Cons</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">Cons</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> Nil<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">f</span>   <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">f</span>   <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> z  <span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Here's a more complete example, tracing the evaluation of <code>foldRight(List(1, 2, 3), 0, (x, y) =&gt; x + y)</code> by repeatedly
substituting the definition of <code>foldRight</code> for its usages.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token function">foldRight</span><span class="token punctuation">(</span><span class="token function">Cons</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">Cons</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">Cons</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> Nil<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span>
<span class="token number">1</span> <span class="token operator">+</span> <span class="token function">foldRight</span><span class="token punctuation">(</span><span class="token function">Cons</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">Cons</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> Nil<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span>
<span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token function">foldRight</span><span class="token punctuation">(</span><span class="token function">Cons</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> Nil<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">+</span> <span class="token function">foldRight</span><span class="token punctuation">(</span>Nil<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">6</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>You can see that <code>foldRight</code> has to traverse the list all the way to the end (using stack frames for each recursive call
as it goes) before it can fully evaluate the result. In other words, it is not tail recursive.</p> <h3 id="exercise-3-7-foldright-and-short-circuiting"><a href="#exercise-3-7-foldright-and-short-circuiting" aria-hidden="true" class="header-anchor">#</a> Exercise 3.7. <code>foldRight</code> and short-circuiting</h3> <p>In our simplified version of <code>product</code>, above, we left out the &quot;short-circuit&quot; behavior of immediately returning 0 when
any list element is 0. Can we regain this behavior, now that <code>product</code> is implemented in terms of <code>foldRight</code>? Why or
why not?</p> <details><summary>Answer</summary> <p>We cannot, because the way <code>foldRight</code> iterates through the list is hidden as an implementation detail. There is nothing
in <code>foldRight</code>'s signature that would let us specify a short-circuiting behavior.</p></details> <h3 id="exercise-3-8-relationship-between-foldright-and-list-data-constructors"><a href="#exercise-3-8-relationship-between-foldright-and-list-data-constructors" aria-hidden="true" class="header-anchor">#</a> Exercise 3.8. Relationship between <code>foldRight</code> and <code>List</code> data constructors</h3> <p>See what happens when you pass <code>Nil</code> and <code>Cons</code> themselves to <code>foldRight</code>, like this: <code>foldRight(List(1, 2, 3), Nil, (h, t) =&gt; new Cons(h, t))</code>. What does this say about the relationship between <code>foldRight</code> and the data constructors of
<code>List</code>?</p> <details><summary>Answer</summary> <p>You get a copy of the original list. You could say that <code>foldRight</code> replaces the <code>Nil</code> constructor with the <code>z</code> value
and the <code>Cons</code> constructor with the result of applying the function <code>f</code>.</p></details> <h3 id="exercise-3-9-length-via-foldright"><a href="#exercise-3-9-length-via-foldright" aria-hidden="true" class="header-anchor">#</a> Exercise 3.9. <code>length</code> via <code>foldRight</code></h3> <p>Compute the length of a list using <code>foldRight</code>.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> length <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> length <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span>
  <span class="token function">foldRight</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> b <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></details> <h3 id="exercise-3-10-foldleft"><a href="#exercise-3-10-foldleft" aria-hidden="true" class="header-anchor">#</a> Exercise 3.10. <code>foldLeft</code></h3> <p>Our implementation of <code>foldRight</code> is not tail-recursive and therefore not stack-safe. Write another function,
<code>foldLeft</code>, that is stack-safe. Recall that even tail recursion isn't stack-safe in TypeScript. Because our <code>List</code>
library will be reused in future exercises, we should probably spend some time making it scale well. Therefore, this is
one of the few times that we'll sacrifice our functional ideals for practical usability gains. Your function should use
an iterative loop and local state mutations, rather than recursion, to achieve stack safety. It may be helpful to start
by writing a tail-recursive version of <code>foldLeft</code> and then transform it into an iterative version.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> foldLeft <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> z<span class="token punctuation">:</span> <span class="token constant">B</span><span class="token punctuation">,</span> <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">b<span class="token punctuation">:</span> <span class="token constant">B</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token constant">B</span></span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// tail-recursive solution</span>
<span class="token keyword">const</span> foldLeft <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> z<span class="token punctuation">:</span> <span class="token constant">B</span><span class="token punctuation">,</span> <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">b<span class="token punctuation">:</span> <span class="token constant">B</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token constant">B</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> go <span class="token operator">=</span> <span class="token punctuation">(</span>la<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> acc<span class="token punctuation">:</span> <span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token constant">B</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>la<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> acc<span class="token punctuation">;</span>
    <span class="token keyword">else</span>
      <span class="token keyword">return</span> <span class="token function">go</span><span class="token punctuation">(</span>la<span class="token punctuation">.</span>tail<span class="token punctuation">,</span> <span class="token function">f</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> la<span class="token punctuation">.</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token function">go</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// iterative solution</span>
<span class="token keyword">const</span> foldLeft <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> z<span class="token punctuation">:</span> <span class="token constant">B</span><span class="token punctuation">,</span> <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">b<span class="token punctuation">:</span> <span class="token constant">B</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token constant">B</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> state <span class="token operator">=</span> z<span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span>tag <span class="token operator">!==</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    state <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> l<span class="token punctuation">.</span>head<span class="token punctuation">)</span><span class="token punctuation">;</span>
    l <span class="token operator">=</span> l<span class="token punctuation">.</span>tail<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></details> <h3 id="exercise-3-11-refactor-sum-product-and-length"><a href="#exercise-3-11-refactor-sum-product-and-length" aria-hidden="true" class="header-anchor">#</a> Exercise 3.11. Refactor <code>sum</code>, <code>product</code>, and <code>length</code></h3> <p>Rewrite <code>sum</code>, <code>product</code>, and <code>length</code> in terms of <code>foldLeft</code>.</p> <details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> sum <span class="token operator">=</span> <span class="token punctuation">(</span>ns<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span>
  <span class="token function">foldLeft</span><span class="token punctuation">(</span>ns<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">tot<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> n <span class="token operator">+</span> tot<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> product <span class="token operator">=</span> <span class="token punctuation">(</span>ns<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span>
  <span class="token function">foldLeft</span><span class="token punctuation">(</span>ns<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">prod<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> n <span class="token operator">*</span> prod<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> length <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span>
  <span class="token function">foldLeft</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">len<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></details> <h3 id="exercise-3-12-reverse"><a href="#exercise-3-12-reverse" aria-hidden="true" class="header-anchor">#</a> Exercise 3.12. <code>reverse</code></h3> <p>Write a function that returns the reverse of a list. See if you can do it using a fold.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> reverse <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> reverse <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span>
  <span class="token function">foldLeft</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">rev<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Cons</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> rev<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></details> <h3 id="exercise-3-13-foldright-and-foldleft-in-terms-of-each-other"><a href="#exercise-3-13-foldright-and-foldleft-in-terms-of-each-other" aria-hidden="true" class="header-anchor">#</a> Exercise 3.13. <code>foldRight</code> and <code>foldLeft</code> in terms of each other</h3> <p>Can you write <code>foldLeft</code> in terms of <code>foldRight</code>? How about the other way around? If we can express <code>foldRight</code> in terms
of <code>foldLeft</code>, we gain the ability to fold a list right-wise in a stack-safe way.</p> <details><summary>Answer</summary> <p>To implement <code>foldLeft</code> in terms of <code>foldRight</code>, we can't just reverse the list and call <code>foldRight</code>, because <code>reverse</code>
calls <code>foldLeft</code>, which would lead to an infinite loop. We could rewrite <code>reverse</code>, but that's no fun!</p> <p>Thinking about <code>reverse</code> leads us to a useful insight: we need to somehow &quot;reverse&quot; the usual order of execution of
<code>foldRight</code>. One strategy is to delay evaluation of the combiner function, <code>f</code>. So rather than immediately computing a
result, we can use <code>foldRight</code> to build up a function that, when evaluated, applies the combiner function to the list
elements in first-to-last order, instead of <code>foldRight</code>'s usual last-to-first order.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> foldLeft <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> z<span class="token punctuation">:</span> <span class="token constant">B</span><span class="token punctuation">,</span> <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">b<span class="token punctuation">:</span> <span class="token constant">B</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token constant">B</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// This is the result type for our inner call to `foldRight`, a function</span>
  <span class="token comment">// that transforms a value of type `B` to a result also of type `B`. Such a</span>
  <span class="token comment">// function is called an &quot;endomorphism&quot;, hence the name of our type alias:</span>
  <span class="token comment">// `END_B`.</span>
  <span class="token keyword">type</span> <span class="token function-variable function">END_B</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">b<span class="token punctuation">:</span> <span class="token constant">B</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">B</span><span class="token punctuation">;</span>

  <span class="token comment">// This is the `z` value for the call to `foldRight`, which is a simple</span>
  <span class="token comment">// identity function.</span>
  <span class="token keyword">const</span> id<span class="token punctuation">:</span> <span class="token function-variable function">END_B</span> <span class="token operator">=</span> <span class="token parameter">b</span> <span class="token operator">=&gt;</span> b<span class="token punctuation">;</span>

  <span class="token comment">// This is the combiner function for the call to `foldRight`. It takes a</span>
  <span class="token comment">// list element, `a`, and an `END_B` function, `g`, and returns another</span>
  <span class="token comment">// `END_B` function that, when applied, calls our original combiner</span>
  <span class="token comment">// function, `f`, with the provided `B` value and the captured `A` value,</span>
  <span class="token comment">// and then passes the result to the captured `END_B` function.</span>
  <span class="token keyword">const</span> <span class="token function-variable function">deferred</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span><span class="token punctuation">,</span> g<span class="token punctuation">:</span> <span class="token constant">END_B</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">b<span class="token punctuation">:</span> <span class="token constant">B</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// We use `foldRight` to build up our reversing function, call it with the</span>
  <span class="token comment">// original `z` value, and return the result.</span>
  <span class="token keyword">return</span> foldRight<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">END_B</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> id<span class="token punctuation">,</span> deferred<span class="token punctuation">)</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>Implementing <code>foldRight</code> in terms of <code>foldLeft</code> is much more straightforward. We just reverse the list and pass it to
<code>foldLeft</code>. Since this gives us a nice, stack-safe <code>foldRight</code> implementation, we'll keep it.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> foldRight <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> z<span class="token punctuation">:</span> <span class="token constant">B</span><span class="token punctuation">,</span> <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token constant">B</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token constant">B</span></span> <span class="token operator">=&gt;</span>
  <span class="token function">foldLeft</span><span class="token punctuation">(</span><span class="token function">reverse</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">b<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></details> <h3 id="exercise-3-14-refactor-append"><a href="#exercise-3-14-refactor-append" aria-hidden="true" class="header-anchor">#</a> Exercise 3.14. Refactor <code>append</code></h3> <p>Rewrite <code>append</code> using either fold.</p> <details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> append <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>a1<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> a2<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span>
  <span class="token function">foldRight</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Cons</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></details> <h3 id="exercise-3-15-concat"><a href="#exercise-3-15-concat" aria-hidden="true" class="header-anchor">#</a> Exercise 3.15 <code>concat</code></h3> <p>Write a function that concatenates a list of lists into a single list, using functions we've already defined. The
runtime of <code>concat</code> should be proportional to the total length of all lists.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> concat <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>ll<span class="token punctuation">:</span> List<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> concat <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>ll<span class="token punctuation">:</span> List<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span>
  <span class="token function">foldRight</span><span class="token punctuation">(</span>ll<span class="token punctuation">,</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">append</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></details> <h3 id="more-functions-for-working-with-lists"><a href="#more-functions-for-working-with-lists" aria-hidden="true" class="header-anchor">#</a> More functions for working with lists</h3> <p>The next set of exercises introduces a few more useful list functions. For each one, we follow the pattern of trying to
accomplish some specific tasks, noticing the commonality between them, writing the general function, and then
refactoring the tasks using our new tool. The purpose of doing these exercises is not to commit to memory every list
function and when to use it, but to begin to develop an intuition for detecting patterns in working with lists and
functional data structures in general. As we proceed through the book, we'll see that these patterns apply to a variety
data structures beyond the humble list, and that there are opportunities for extracting these patterns into highly
abstract functions that we can use in any domain.</p> <h3 id="exercise-3-16-add-1-to-each-element"><a href="#exercise-3-16-add-1-to-each-element" aria-hidden="true" class="header-anchor">#</a> Exercise 3.16. Add <code>1</code> to each element</h3> <p>Write a function that transforms a list of integers by adding 1 to each element. (Reminder: this should be a pure
function that returns a new List!)</p> <details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> addOne <span class="token operator">=</span> <span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span>
  <span class="token function">foldRight</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Cons</span><span class="token punctuation">(</span>a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></details> <h3 id="exercise-3-17-convert-number-to-string"><a href="#exercise-3-17-convert-number-to-string" aria-hidden="true" class="header-anchor">#</a> Exercise 3.17. Convert <code>number</code> to <code>string</code></h3> <p>Write a function that turns each value in a <code>List&lt;number&gt;</code> into a <code>string</code>. You can use the expression <code>n.toString()</code> to
convert some <code>n: number</code> to a <code>string</code>.</p> <details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> toString <span class="token operator">=</span> <span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span>
  <span class="token function">foldRight</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Cons</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></details> <h3 id="exercise-3-18-map"><a href="#exercise-3-18-map" aria-hidden="true" class="header-anchor">#</a> Exercise 3.18. <code>map</code></h3> <p>Write a function <code>map</code> that generalizes modifying each element in a list while maintaining the structure of the list.
Then, refactor your answers to the previous two exercises using <code>map</code>. Here is its signature:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>la<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span>
  <span class="token function">foldRight</span><span class="token punctuation">(</span>la<span class="token punctuation">,</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Cons</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></details> <h3 id="exercise-3-19-filter"><a href="#exercise-3-19-filter" aria-hidden="true" class="header-anchor">#</a> Exercise 3.19. <code>filter</code></h3> <p>Write <code>filter</code>, a function that removes elements from a list unless they satisfy a predicate. Then practice using it by
removing all odd numbers from a <code>List&lt;number&gt;</code>. Is it possible to implement <code>filter</code> in terms of <code>map</code>? Why, or why not?</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> filter <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token function-variable function">p</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> filter <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token function-variable function">p</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span>
  <span class="token function">foldRight</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> acc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">p</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">Cons</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> acc<span class="token punctuation">)</span> <span class="token punctuation">:</span> acc<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></details> <h3 id="exercise-3-20-flatmap"><a href="#exercise-3-20-flatmap" aria-hidden="true" class="header-anchor">#</a> Exercise 3.20. <code>flatMap</code></h3> <p>Write a function named <code>flatMap</code> that works similarly to <code>map</code>, except the provided function returns a <code>List</code> instead of
a raw value. That <code>List</code> should be inserted into the resulting <code>List</code>. For example, <code>flatMap(List(1, 2, 3), i =&gt; List(i, i))</code> should return <code>List(1, 1, 2, 2, 3, 3)</code>.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> flatMap <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> List<span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> flatMap <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> List<span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span>
  <span class="token function">foldRight</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> acc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> acc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></details> <h3 id="exercise-3-21-filter-in-terms-of-flatmap"><a href="#exercise-3-21-filter-in-terms-of-flatmap" aria-hidden="true" class="header-anchor">#</a> Exercise 3.21. <code>filter</code> in terms of <code>flatMap</code></h3> <p>Re-implement <code>filter</code> using <code>flatMap</code>. As a bonus, can you implement <code>map</code> in terms of <code>flatMap</code>?</p> <details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> filter <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token function-variable function">p</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span>
  <span class="token function">flatMap</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> <span class="token parameter">a</span> <span class="token operator">=&gt;</span> <span class="token function">p</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">List</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>la<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span>
  <span class="token function">flatMap</span><span class="token punctuation">(</span>la<span class="token punctuation">,</span> <span class="token parameter">a</span> <span class="token operator">=&gt;</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></details> <h3 id="exercise-3-22-add-corresponding-elements"><a href="#exercise-3-22-add-corresponding-elements" aria-hidden="true" class="header-anchor">#</a> Exercise 3.22. Add corresponding elements</h3> <p>Write a function that, given two lists, returns a new list consisting of the sums of corresponding elements in the
argument lists. For example, given <code>List(1, 2, 3)</code> and <code>List(4, 5, 6)</code>, it should return <code>List(5, 7, 9)</code>.</p> <details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> addCorresponding <span class="token operator">=</span> <span class="token punctuation">(</span>a1<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> a2<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">foldRight</span><span class="token punctuation">(</span>
    a1<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token function">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token function">reverse</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> <span class="token punctuation">[</span>acc<span class="token punctuation">,</span> other<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>other<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;cons&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Cons</span><span class="token punctuation">(</span>a <span class="token operator">+</span> other<span class="token punctuation">.</span>head<span class="token punctuation">,</span> acc<span class="token punctuation">)</span><span class="token punctuation">,</span> other<span class="token punctuation">.</span>tail<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>acc<span class="token punctuation">,</span> other<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></details> <h3 id="exercise-3-23-zipwith"><a href="#exercise-3-23-zipwith" aria-hidden="true" class="header-anchor">#</a> Exercise 3.23. <code>zipWith</code></h3> <p>Generalize the previous function so that it's not specific to numbers or addition. Call it <code>zipWith</code>, and then refactor
the previous function to use <code>zipWith</code>.</p> <details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> zipWith <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>
    la<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    lb<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token constant">B</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">C</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">C</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>la<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;nil&quot;</span> <span class="token operator">||</span> lb<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> Nil<span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Cons</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>la<span class="token punctuation">.</span>head<span class="token punctuation">,</span> lb<span class="token punctuation">.</span>head<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">zipWith</span><span class="token punctuation">(</span>la<span class="token punctuation">.</span>tail<span class="token punctuation">,</span> lb<span class="token punctuation">.</span>tail<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// or, using a fold:</span>
<span class="token keyword">const</span> zipWith <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>
    la<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    lb<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token constant">B</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">C</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">C</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">reverse</span><span class="token punctuation">(</span>foldLeft<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>List<span class="token operator">&lt;</span><span class="token constant">C</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> List<span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>
    la<span class="token punctuation">,</span>
    <span class="token punctuation">[</span>Nil<span class="token punctuation">,</span> lb<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>acc<span class="token punctuation">,</span> rem<span class="token punctuation">]</span><span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>rem<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;cons&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Cons</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> rem<span class="token punctuation">.</span>head<span class="token punctuation">)</span><span class="token punctuation">,</span> acc<span class="token punctuation">)</span><span class="token punctuation">,</span> rem<span class="token punctuation">.</span>tail<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>acc<span class="token punctuation">,</span> rem<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// and the refactored `addCorresponding`:</span>
<span class="token keyword">const</span> addCorresponding <span class="token operator">=</span> <span class="token punctuation">(</span>a1<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> a2<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">zipWith</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> n1 <span class="token operator">+</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div></details> <h3 id="loss-of-efficiency-when-assembling-list-functions-from-simpler-components"><a href="#loss-of-efficiency-when-assembling-list-functions-from-simpler-components" aria-hidden="true" class="header-anchor">#</a> Loss of efficiency when assembling list functions from simpler components</h3> <p>Sometimes, when we express <code>List</code> operations in terms of general-purpose functions, we end up with inefficient
implementations, even though the code ends up being very concise and readable. We may wind up making several passes over
input lists, or having to write explicit loops to allow for early termination.</p> <h3 id="exercise-3-24-hassubsequence"><a href="#exercise-3-24-hassubsequence" aria-hidden="true" class="header-anchor">#</a> Exercise 3.24. <code>hasSubsequence</code></h3> <p>Write a function, called <code>hasSubsequence</code>, to check whether a <code>List</code> contains another <code>List</code> as a subsequence. For
example, <code>List(&quot;a&quot;, &quot;b&quot;, &quot;r&quot;, &quot;a&quot;)</code> has subsequences <code>List(&quot;b&quot;, &quot;r&quot;)</code> and <code>List(&quot;a&quot;)</code>, among others. This is meant to
illustrate the previous point about efficiency, so you will probably have some difficulty expressing this in a purely
functional, efficient manner. We'll return to this problem, and hopefully find a better answer, in Chapter 5.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> hasSubsequence <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>sup<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> sub<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">boolean</span></span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// This is just one of many possible implementations, none of which can be</span>
<span class="token comment">// both succinct and efficient. This version of the function, for example,</span>
<span class="token comment">// is terse, but must process every element of `sup`, even if the subsequence</span>
<span class="token comment">// has already been found. Our `List` API just doesn't give us the tools we</span>
<span class="token comment">// need to accomplish elegantly this task.</span>
<span class="token keyword">const</span> hasSubsequence <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>sup<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> sub<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">boolean</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> folded <span class="token operator">=</span> <span class="token function">foldLeft</span><span class="token punctuation">(</span>sup<span class="token punctuation">,</span> sub<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">rem<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rem<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> Nil<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">===</span> rem<span class="token punctuation">.</span>head<span class="token punctuation">)</span>
      <span class="token keyword">return</span> rem<span class="token punctuation">.</span>tail<span class="token punctuation">;</span>
    <span class="token keyword">else</span>
      <span class="token keyword">return</span> sub<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> folded <span class="token operator">===</span> Nil<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></details> <h2 id="trees"><a href="#trees" aria-hidden="true" class="header-anchor">#</a> Trees</h2> <p><code>List</code> is just one example of an algebraic data type (ADT), which we discussed earlier in the chapter. In this section we'll
introduce the <code>Tree</code>, which is a recursive, hierarchical data structure.</p> <div class="tip custom-block"><p class="custom-block-title">Tuple types in TypeScript</p> <p>We briefly touched on tuples in Chapter 1. A tuple is a bit like a <code>List</code>, except its size and the types of all its
elements, which need not be the same type, are known at compile time. A tuple of &quot;arity&quot;, or size, 2 is often referred
to simply as a pair. Tuples are themselves ADTs. TypeScript borrows JavaScript's array syntax to define both tuple types
and tuple values.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&gt; const p: [string, number] = [&quot;Bob&quot;, 42];
&gt; p[0];
'Bob'
&gt; p[0] = 41;
[eval].ts(5,1): error TS2322: Type '2' is not assignable to type 'string'.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>In fact, TypeScript tuples <em>are</em> just JavaScript arrays with some additional type information. TypeScript keeps track of
the type of each element of a tuple, and throws errors like the one above if you attempt to assign a value to a position
in a tuple with an incompatible type.</p></div> <p>Here's a simple binary tree data structure. You should recognize the tagged union technique we introduced earlier with
<code>List</code>.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">type</span> Tree<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=</span> Leaf<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">|</span> Branch<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Leaf</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  tag<span class="token punctuation">:</span> <span class="token string">&quot;leaf&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;leaf&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">readonly</span> value<span class="token punctuation">:</span> <span class="token constant">A</span><span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Branch</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  tag<span class="token punctuation">:</span> <span class="token string">&quot;branch&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;branch&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">readonly</span> left<span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token keyword">readonly</span> right<span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">left<span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> right<span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">=</span> left<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">=</span> right<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>                          A Tree

                          Branch
                      ┌─────┬─────┐
             ┌────────┼──●  │  ●──┼───────┐
             │        └─────┴─────┘       │
             ↓         left  right        ↓
           Branch                       Branch
       ┌─────┬─────┐                ┌─────┬─────┐
   ┌───┼──●  │  ●──┼───┐        ┌───┼──●  │  ●──┼───┐
   │   └─────┴─────┘   │        │   └─────┴─────┘   │
   ↓    left  right    ↓        ↓    left  right    ↓
  Leaf                Leaf     Leaf                Leaf
┌─────┐             ┌─────┐  ┌─────┐             ┌─────┐
│ &quot;a&quot; │             │ &quot;b&quot; │  │ &quot;c&quot; │             │ &quot;d&quot; │
└─────┘             └─────┘  └─────┘             └─────┘
 value               value    value               value
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="exercise-3-25-size"><a href="#exercise-3-25-size" aria-hidden="true" class="header-anchor">#</a> Exercise 3.25. <code>size</code></h3> <p>Write a function named <code>size</code> that counts the number of leaves and branches (collectively called &quot;nodes&quot;) in a tree.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> size <span class="token operator">=</span> <span class="token punctuation">(</span>ta<span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token builtin">unknown</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">The unknown type</p> <p>The <code>unknown</code> type signifies to TypeScript that we do not know what type of values the passed-in tree contains, and also
that we do not care. Our <code>size</code> function needs to know nothing about the values to do its job. Attempting to reference
the values in the Leaf nodes would cause a compile error. The <code>unknown</code> type can help enforce the constraint that a
function maintain a strict ignorance about values contained in the structures it deals with, and therefore prevent
accidentally coupling the function to a type.</p></div> <details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> size <span class="token operator">=</span> <span class="token punctuation">(</span>t<span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token builtin">unknown</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;leaf&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token function">size</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">size</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></details> <h3 id="exercise-3-26-maximum"><a href="#exercise-3-26-maximum" aria-hidden="true" class="header-anchor">#</a> Exercise 3.26. <code>maximum</code></h3> <p>Write a function <code>maximum</code> that returns the maximum value contained in a tree of numbers. You can use TypeScript's
built-in <code>Math.max(x, y)</code> function to calculate the maximum of two numbers <code>x</code> and <code>y</code>.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> maximum <span class="token operator">=</span> <span class="token punctuation">(</span>tn<span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> maximum <span class="token operator">=</span> <span class="token punctuation">(</span>t<span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;leaf&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> t<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">maximum</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">maximum</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></details> <h3 id="exercise-3-27-depth"><a href="#exercise-3-27-depth" aria-hidden="true" class="header-anchor">#</a> Exercise 3.27. <code>depth</code></h3> <p>Write a function <code>depth</code> that returns the maximum path length from the &quot;root&quot;, or top, of a tree to any leaf.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> depth <span class="token operator">=</span> <span class="token punctuation">(</span>ta<span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token builtin">unknown</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> depth <span class="token operator">=</span> <span class="token punctuation">(</span>t<span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token builtin">unknown</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;leaf&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">depth</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">depth</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></details> <h3 id="exercise-3-28-map"><a href="#exercise-3-28-map" aria-hidden="true" class="header-anchor">#</a> Exercise 3.28. <code>map</code></h3> <p>Write the <code>Tree</code> version of <code>map</code>. As with the <code>List</code> version, it should return a <code>Tree</code> with the same shape as the
input <code>Tree</code>, but with elements transformed by a provided function.</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>ta<span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;leaf&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Leaf</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Branch</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>left<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">map</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>right<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></details> <div class="tip custom-block"><p class="custom-block-title">ADTs and encapsulation</p> <p>As you've worked through the exercises in this chapter, you may have caught yourself thinking, &quot;Wow, it sure seems like
we're exposing an awful lot of the internals of our data structures to the users of our API.&quot; To quote the book:</p> <blockquote><p>In FP, we approach concerns about encapsulation differently—we don’t typically have delicate mutable state which could
lead to bugs or violation of invariants if exposed publicly. Exposing the data constructors of a type is often fine,
and the decision to do so is approached much like any other decision about what the public API of a data type should
be.</p></blockquote> <p>ADTs are typically used in scenarios where the set of possible data constructors is known to be fixed, or closed. Since
we do not expect to have to support adding new cases to our types very often, the advantages of techniques like pattern
matching and directly exposing the structure of data types to API consumers outweigh the disadvantages, such as the
amount of code that would have to be touched to add a new case.</p></div> <h3 id="exercise-3-29"><a href="#exercise-3-29" aria-hidden="true" class="header-anchor">#</a> Exercise 3.29</h3> <p>Write a new function, called <code>fold</code>, that abstracts over the similarities between <code>size</code>, <code>maximum</code>, <code>depth</code>, and <code>map</code>.
Then, reimplement those functions in terms of <code>fold</code>. Can you describe the connection between this <code>fold</code> and the left
and right folds of <code>List</code>?</p> <details><summary>Answer</summary> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> fold <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">B</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">g</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">l<span class="token punctuation">:</span> <span class="token constant">B</span><span class="token punctuation">,</span> r<span class="token punctuation">:</span> <span class="token constant">B</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token constant">B</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;leaf&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    <span class="token keyword">return</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token function">fold</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>left<span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">fold</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>right<span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> size <span class="token operator">=</span> <span class="token punctuation">(</span>t<span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token builtin">unknown</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span>
  <span class="token function">fold</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">l<span class="token punctuation">,</span> r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> l <span class="token operator">+</span> r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> maximum <span class="token operator">=</span> <span class="token punctuation">(</span>t<span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span>
  <span class="token function">fold</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token parameter">n</span> <span class="token operator">=&gt;</span> n<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">l<span class="token punctuation">,</span> r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> depth <span class="token operator">=</span> <span class="token punctuation">(</span>t<span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token builtin">unknown</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span>
  <span class="token function">fold</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token parameter">a</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">l<span class="token punctuation">,</span> r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Tree<span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">fold</span><span class="token punctuation">(</span>
    t<span class="token punctuation">,</span>
    <span class="token parameter">a</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Leaf</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Tree<span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">l<span class="token punctuation">,</span> r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Branch</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>Folding over a tree and folding over a list do the same thing, conceptually: collapse a data structure into a value
(which may itself be a data structure) by incrementally applying functions to each node of the structure, carrying along
an intermediate value in an &quot;accumulator&quot;. Our <code>fold</code> implementation for trees is similar to <code>foldRight</code> for lists in
that the caller needs to specify how to deal with each data constructor. Recall <code>foldRight</code>:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> foldRight <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> z<span class="token punctuation">:</span> <span class="token constant">B</span><span class="token punctuation">,</span> <span class="token function-variable function">f</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token constant">B</span></span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The function <code>f</code> handles the <code>Cons</code> data constructor, while <code>Nil</code> is simply replaced with the &quot;zero&quot; value, <code>z</code>. For
trees, we need to specify two functions, <code>f</code> for <code>Leaf</code> nodes and <code>g</code> for <code>Branch</code> nodes. Analagously to the <code>List</code>
case, passing the data constructor functions for <code>f</code> and <code>g</code> copies the tree: <code>fold(t, a =&gt; new Leaf(a), (l, r) =&gt; new Branch(l, r))</code>.</p></details> <h2 id="summary"><a href="#summary" aria-hidden="true" class="header-anchor">#</a> Summary</h2> <p>Breathe a sigh of relief, you made it through Chapter 3! Hopefully, you've become more comfortable with writing and and
generalizing pure functions in TypeScript. The rabbit hole only gets deeper from here. Next up: how to handle errors
while adhering to functional principals. In other words, without exceptions.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">4/20/2020, 7:46:22 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/fp_book_club_ts/chapter_2.html" class="prev">
          Chapter 2. Getting started with functional programming in TypeScript
        </a></span> <span class="next"><a href="/fp_book_club_ts/chapter_4.html">
          Chapter 4. Handling errors without exceptions
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/fp_book_club_ts/assets/js/app.ba8d5564.js" defer></script><script src="/fp_book_club_ts/assets/js/2.02fd0292.js" defer></script><script src="/fp_book_club_ts/assets/js/8.57c5fc43.js" defer></script>
  </body>
</html>
