<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter 4. Handling errors without exceptions</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/fp_book_club_ts/assets/css/styles.0af8ace6.css" as="style"><link rel="preload" href="/fp_book_club_ts/assets/js/app.0af8ace6.js" as="script"><link rel="preload" href="/fp_book_club_ts/assets/js/7.6473d633.js" as="script"><link rel="prefetch" href="/fp_book_club_ts/assets/js/2.a40b0877.js"><link rel="prefetch" href="/fp_book_club_ts/assets/css/1.styles.5a8ea794.css"><link rel="prefetch" href="/fp_book_club_ts/assets/js/1.5a8ea794.js"><link rel="prefetch" href="/fp_book_club_ts/assets/css/2.styles.a40b0877.css"><link rel="prefetch" href="/fp_book_club_ts/assets/js/3.813ae6c2.js"><link rel="prefetch" href="/fp_book_club_ts/assets/js/4.52763c4d.js"><link rel="prefetch" href="/fp_book_club_ts/assets/js/5.0554fceb.js"><link rel="prefetch" href="/fp_book_club_ts/assets/js/6.108e95f6.js">
    <link rel="stylesheet" href="/fp_book_club_ts/assets/css/1.styles.5a8ea794.css"><link rel="stylesheet" href="/fp_book_club_ts/assets/css/2.styles.a40b0877.css"><link rel="stylesheet" href="/fp_book_club_ts/assets/css/styles.0af8ace6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fp_book_club_ts/" class="home-link router-link-active"></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fp_book_club_ts/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Chapters</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_1.html" class="nav-link">Chapter 1</a></li><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_2.html" class="nav-link">Chapter 2</a></li><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_3.html" class="nav-link">Chapter 3</a></li><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_4.html" class="nav-link router-link-exact-active router-link-active">Chapter 4</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/calebharris/fp_book_club_ts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fp_book_club_ts/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Chapters</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_1.html" class="nav-link">Chapter 1</a></li><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_2.html" class="nav-link">Chapter 2</a></li><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_3.html" class="nav-link">Chapter 3</a></li><li class="dropdown-item"><!----> <a href="/fp_book_club_ts/chapter_4.html" class="nav-link router-link-exact-active router-link-active">Chapter 4</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/calebharris/fp_book_club_ts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/fp_book_club_ts/chapter_1.html" class="sidebar-link">Chapter 1. What is functional programming?</a></li><li><a href="/fp_book_club_ts/chapter_2.html" class="sidebar-link">Chapter 2. Getting started with functional programming in TypeScript</a></li><li><a href="/fp_book_club_ts/chapter_3.html" class="sidebar-link">Chapter 3. Functional data structures</a></li><li><a href="/fp_book_club_ts/chapter_4.html" class="active sidebar-link">Chapter 4. Handling errors without exceptions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_4.html#possible-alternatives-to-exceptions" class="sidebar-link">Possible alternatives to exceptions</a></li><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_4.html#the-option-data-type" class="sidebar-link">The Option data type</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fp_book_club_ts/chapter_4.html#usage-patterns-for-option" class="sidebar-link">Usage patterns for Option</a></li></ul></li></ul></li></ul> </div> <div class="page"> <div class="content"><h1 id="chapter-4-handling-errors-without-exceptions"><a href="#chapter-4-handling-errors-without-exceptions" aria-hidden="true" class="header-anchor">#</a> Chapter 4. Handling errors without exceptions</h1> <p>Exceptions, as mentioned in <a href="/fp_book_club_ts/chapter_1.html">Chapter 1</a>, are not a great fit for functional programming for a couple
reasons:</p> <ol><li>They break referential transparency (RT).</li> <li>They are not type-safe: the type of a function says nothing about whether or not it can throw an exception, so the
compiler loses some ability to enforce correctness.</li></ol> <p>Exceptions <em>do</em> have an upside, in that they allow the programmer to consolidate error-handling logic.</p> <p>In this chapter, we'll learn how to use types to encode failures and error conditions, so that we can capture them as
ordinary values. This lets us keep our FP principles intact while maintaining the benefit of error-handling
consolidation.</p> <h2 id="possible-alternatives-to-exceptions"><a href="#possible-alternatives-to-exceptions" aria-hidden="true" class="header-anchor">#</a> Possible alternatives to exceptions</h2> <p>Consider this example, which computes the mean of a list:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">mean</span><span class="token punctuation">(</span>xs<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xs<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Attempt to take mean of empty list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token function">sum</span><span class="token punctuation">(</span>xs<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">length</span><span class="token punctuation">(</span>xs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>It's a <em>partial function</em>, which means its result is undefined for some input values. Throwing an exception is one way
of handling these values, but there are others:</p> <p>We could return a special value, like <code>NaN</code> (which is TypeScript for &quot;not a number&quot;) or <code>null</code>, but there are several
drawbacks to this approach.</p> <ul><li>Makes it easy for errors to proliferate due to callers neglecting to check for this special value</li> <li>Creates need for boilerplate error checking code</li> <li>Doesn't work with polymorphic code. For some input types, there may not be an appropriate special value to return</li> <li>Forces a special policy on callers, who can't simply call the function and use the result, which makes it difficult
to compose <code>mean</code> with other functions</li></ul> <p>We could change <code>mean</code>'s API and force the caller to provide the value to return for empty lists, like this:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">mean</span><span class="token punctuation">(</span>xs<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> onEmpty<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xs<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> onEmpty<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token function">sum</span><span class="token punctuation">(</span>xs<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">length</span><span class="token punctuation">(</span>xs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>But this requires immediate callers to have knowledge of how to handle the special cases, again making it difficult to
compose the function into a larger computation, and limiting the freedom the caller has to decide how to handle special
cases.</p> <h2 id="the-option-data-type"><a href="#the-option-data-type" aria-hidden="true" class="header-anchor">#</a> The <code>Option</code> data type</h2> <p>A functional solution to this problem is to encode into the function's return type the possibility of not returning a
value. Behold, the <code>Option</code> type!</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">type</span> Option<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=</span> Some<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">|</span> None<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Some</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  readonly tag<span class="token punctuation">:</span> <span class="token string">&quot;some&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;some&quot;</span><span class="token punctuation">;</span>
  readonly value<span class="token punctuation">:</span> <span class="token constant">A</span><span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token constant">A</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">None</span> <span class="token keyword">extends</span> <span class="token class-name">OptionBase</span><span class="token operator">&lt;</span>never<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  readonly tag<span class="token punctuation">:</span> <span class="token string">&quot;none&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token constant">NONE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">None</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><code>Option</code>, like <code>List</code>, has one type parameter, which is the type of value that it might contain. An <code>Option</code> can be
either <code>Some</code>, meaning it definitely has a value, or <code>None</code> meaning the value is not defined.</p> <p>Where as <code>List</code> represents the idea that multiple values of a type may exist, <code>Option</code> represents the idea that a value
may not exist at all. In FP, both of these notions are examples of <em>effects</em> (which are distinct from <em>side effects</em>).
<code>List</code> models the effect of having multiple values; <code>Option</code> models the effect of optionality.</p> <p>We can use <code>Option</code> to rewrite <code>mean</code> as a <em>total function</em>:</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">mean</span><span class="token punctuation">(</span>xs<span class="token punctuation">:</span> List<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Option<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xs<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&quot;nil&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token constant">NONE</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span>xs<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">length</span><span class="token punctuation">(</span>xs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>It now always has a defined result, which is <code>None</code> when the input list is empty.</p> <h3 id="usage-patterns-for-option"><a href="#usage-patterns-for-option" aria-hidden="true" class="header-anchor">#</a> Usage patterns for <code>Option</code></h3> <p><code>Option</code> is convenient because we can factor out common error-handling patterns into higher-order functions, meaning we
can dispense with much of the boilerplate that comes with exception-oriented code.</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">10/18/2018, 1:00:08 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ‚Üê
        <a href="/fp_book_club_ts/chapter_3.html" class="prev">
          Chapter 3. Functional data structures
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/fp_book_club_ts/assets/js/7.6473d633.js" defer></script><script src="/fp_book_club_ts/assets/js/app.0af8ace6.js" defer></script>
  </body>
</html>
